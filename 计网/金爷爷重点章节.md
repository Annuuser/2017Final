## *1.6 协议组和分层模型

Protocal Suites And Layering Models

#### 网络协议

一组交换信息的规则

信息的格式和每一组信息需要的动作

#### 协议组

协议组：一个总体的设计规划—— 每个协议设计不能是分离的，而应该是整体协调的设计所有协议

* 协议组中的每个协议只处理通信功能的一部分
* 所有协议联合起来完成所有通信功能，包括硬件故障和其他意外情况的处理
* 所设计的完整协议组中的协议能够高效统一的工作

#### 分层模型

分层模型：把各种协议集中成为一个统一的抽象结构

层：本质上描述的是如何把通信问题的所有方面划分成一个个协调工作的分块结构，每一个分块叫做一个层

把协议划分到不同的层中，使它们各自在给定时间内着重于处理通信的某部分功能，从而有助于减少协议设计和实现的复杂性

#### 因特网协议（TCP/IP）的分层模型

##### 物理层

规定底层传输介质和硬件细节

与电气特性、无线电频率和信号等有关的所有规范

##### 网络接口层或MAC

规定了单一网络间的通信以及网络硬件与第三层的接口（通过软件实现）

有关网络地址、网络可支持的最大分组长度、用于接入底层介质的协议以及硬件寻址等方面的规范

##### 网络互连层

因特网最重要的基础

两台计算机通过因特网进行通信的细节

因特网编址结构、分组格式、大分组分成小分组传输的方法以及差错报告机制

##### 传输层

TCP属于传输层

为一台计算机上的应用程序与另一台计算机上的应用程序之间提供通信手段

数据接收速率、避免网络拥塞的机制、确保所有数据以正确的顺序接收的技术

运输层主要为两台主机上的应用程序提供端到端的通信。在 T C P / I P 协 议 族 中 ， 有 两 个互 不 相 同 的 传 输 协 议 : T C P ( 传 输 控 制 协 议 ) 和 U D P ( 用 户 数 据 报 协 议 )。

##### 应用层

TCP/IP协议栈的最高层，规定一对应用进程在通信的时候如何交互以及交互时的信息含义和格式

应用层负责处理特定的应用程序细节。几乎各种不同的 T C P / I P 实 现 都 会 提 供 下 面 这 些通用的应用程序:

* Telnet 远程登录。
* FTP 文件传输协议。
* SMTP 简单邮件传送协议。
  * SNMP 简单网络管理协议。

信息传输：

* 传输层增加端口号
* 网络互连层增加IP地址
* 网络接口层增加CRC

## *1.9 ISO与OSI七层模型

* 国际标准化组织（ISO）
* 国际电信联盟，电信标准化组（ITU-T）

ISO的分层模型

##### 1 物理层

基础硬件通信

##### 2 数据链路层

帧格式和错误处理

##### 3 网络层

物理地址

处理帧传输和接受的细节

##### 4 传输层

如何处理可靠传输的细节

##### 5 会话层

如何建立远程传输

##### 6 表示层

如何展示数据

##### 7 应用层

一个具体的应用怎样使用网络

## 题1.14

请列出OSI模型各个层功能

第一层：物理层(PhysicalLayer)，

规定通信设备的机械的、电气的、功能的和过程的特性，用以建立、维护和拆除物理链路连接。具体地讲，机械 特性规定了网络连接时所需接插件的规格尺寸、引脚数量和排列情况等;电气特性规定了在物理连接上传输bit流时线路上信号电平的大小、阻抗匹配、传输速率 距离限制等;功能特性是指对各个信号先分配确切的信号含义，即定义了DTE和DCE之间各个线路的功能;规程特性定义了利用信号线进行bit流传输的一组 操作规程，是指在物理连接的建立、维护、交换信息是，DTE和DCE双放在各电路上的动作系列。在这一层，数据的单位称为比特(bit)。属于物理层定义的典型规范代表包括：EIA/TIA RS-232、EIA/TIA RS-449、V.35、RJ-45等。

第二层：数据链路层(DataLinkLayer):

在物理层提供比特流服务的基础上，建立相邻结点之间的数据链路，通过差错控制提供数据帧(Frame)在信道上无差错的传输，并进行各电路上的动作系列。数据链路层在不可靠的物理介质上提供可靠的传输。该层的作用包括：物理地址寻址、数据的成帧、流量控制、数据的检错、重发等。在这一层，数据的单位称为帧(frame)。数据链路层协议的代表包括：SDLC、HDLC、PPP、STP、帧中继等。

第三层是网络层

在 计算机网络中进行通信的两个计算机之间可能会经过很多个数据链路，也可能还要经过很多通信子网。网络层的任务就是选择合适的网间路由和交换结点， 确保数据及时传送。网络层将数据链路层提供的帧组成数据包，包中封装有网络层包头，其中含有逻辑地址信息- -源站点和目的站点地址的网络地址。如 果你在谈论一个IP地址，那么你是在处理第3层的问题，这是“数据包”问题，而不是第2层的“帧”。IP是第3层问题的一部分，此外还有一些路由协议和地 址解析协议(ARP)。有关路由的一切事情都在这第3层处理。地址解析和路由是3层的重要目的。网络层还可以实现拥塞控制、网际互连等功能。在这一层，数据的单位称为数据包(packet)。网络层协议的代表包括：IP、IPX、RIP、OSPF等。

第 四层是处理信息的传输层

第4层的数据单元也称作数据包(packets)。但是，当你谈论TCP等具体的协议时又有特殊的叫法，TCP的数据单元称为段 (segments)而UDP协议的数据单元称为“数据报(datagrams)”。这个层负责获取全部信息，因此，它必须跟踪数据单元碎片、乱序到达的 数据包和其它在传输过程中可能发生的危险。第4层为上层提供端到端(最终用户到最终用户)的透明的、可靠的数据传输服务。所为透明的传输是指在通信过程中 传输层对上层屏蔽了通信传输系统的具体细节。传输层协议的代表包括：TCP、UDP、SPX等。

第五层是会话层

这一层也可以称为会晤层或对话层，在会话层及以上的高层次中，数据传送的单位不再另外命名，而是统称为报文。会话层不参与具体的传输，它提供包括访问验证和会话管理在内的建立和维护应用之间通信的机制。如服务器验证用户登录便是由会话层完成的。

第六层是表示层

这一层主要解决拥护信息的语法表示问题。它将欲交换的数据从适合于某一用户的抽象语法，转换为适合于OSI系统内部使用的传送语法。即提供格式化的表示和转换数据服务。数据的压缩和解压缩， 加密和解密等工作都由表示层负责。

第七层应用层

应用层为操作系统或网络应用程序提供访问网络服务的接口。应用层协议的代表包括：Telnet、FTP、HTTP、SNMP等。

## FTP

文件传输协议（FTP）提供大文件的下载

## 电子邮件

电子邮件使用了3中类型的应用层协议：传送、表示和访问。简单邮件传输协议（SMTP）是关键的传输标准，但仅能传送文本报文

**老师说就考两个端口**

**smtp发送25**

**pop接受110**



## 题4.12

#### 两个链接

当用户要请求一个FTP目录列表时，会形成几个TCP连接？解释之

控制连接：客户请求建立的原始连接，用于传送命令

数据连接：当服务器每次需要下载或者上传文件时，开通的新连接称为数据连接

* 数据连接使得FTP反转了客户—服务器的关系，即开通数据库连接时，客户的作用像服务器，而服务器的作用像客户。
* 数据连接传输完成数据以后数据关闭

获取公开的文件常使用

* 用户名：“annoymous”
* 密码：“guest”

服务器对每次请求在控制链接上会送一个数值的状态作为响应，包括登录请求，使得客户知道是否请求成功

#### 协议端口号

FTP协议允许客户端决定：客户向服务器发出请求前，在本地操作系统上客户分配一个协议端口号，并将其发送给服务器

客户是绑定该端口号等待控制连接的建立，然后再控制连接上作为十进制串发送该协议端口号。

#### 算法

给定：一个FTP控制连接

实现：在一个TCP连接上传输一个文件

方法：

在控制连接上，客户发送一对特定的文件的请求

客户分配一个本地协议端口号，称为X，并绑定到端口X

在控制连接上，客户发送PORT X给服务器

客户在PORT X上等待接受数据连接

服务器接受PORT命令和提取端口数据

原服务器扮演客户的角色，向客户计算机的端口X创建一个TCP连接

原客户临时扮演服务器角色，接受该TCP连接（数据连接）

在数据连接上，服务器发送被请求的文件

服务器关闭数据连接

## telnet作用

T e l n e t是 标 准 的 提 供 远 程 登 录 功 能 的 应 用 ， 几 乎 每 个 T C P / I P 的 实 现 都 提 供 这 个 功 能 。 它能 够 运 行 在 不 同 操 作 系 统 的 主 机 之 间 。T e l n e t 通 过 客 户 进 程 和 服 务 器 进 程 之 间 的 选 项 协 商 机 制 ，从而确定通信双方可以提供的功能特性。

1) T e l n e t客户进程同时和终端用户和 T C P / I P 协 议 模 块 进 行 交 互 。 通 常 我 们 所 键 入 的 任 何 信息的传输是通过 T C P 连接，连接的任何返回信息都输出到终端上。		
2 ) T e l n e t 服 务 器 进 程 经 常 要 和 一 种 叫 做 “ 伪 终 端 设 备 ”( p s e u d o - t e r m i n a l d e v i c e )打交道，至少在 U n i x 系 统 下 是 这 样 的 。 这 就 使 得 对 于 登 录 外 壳 ( s h e l l ) 进 程 来 讲 ， 它 是 被 T e l n e t 服务器进程直接调用的，而且任何运行在登录外壳进程处的程序都感觉是直接和一个终端进行交互。对于像满屏编辑器这样的应用来讲，就像直接在和终端打交道一样。

3) 仅 仅 使 用 了 一 条 T C P 连 接 。 由 于 客 户 进 程 必 须 多 次 和 服 务 器 进 程 进 行 通 信 ( 反 之 亦 然 )，这就必然需要某些方法，来描绘在连接上传输的命令和用户数据。			

4) 注意在图 2 6 - 1 中，我们用虚线框把终端驱动进程和伪终端驱动进程框了起来。在T C P / I P 实 现 中 ， 虚 线 框 的 内 容 一 般 是 操 作 系 统 内 核 的 一 部 分 。 Te l n e t 客 户 进 程 和 服 务 器 进 程 一般只是属于用户应用程序。

5) 把服务器进程的登录外壳进程画出来的目的是为了说明:当我们想登录到系统的时候，必须要有一个帐号， Te l n e t 和 R l o g i n 都是如此

客户进程发出的字节数(用户在终端上键入的信息)和服务器进程端发出的字节数的数量之比是 1 : 2 0 。 这 是 因 为 我 们 在 终 端 上 键 入的一条短命令往往令服务器进程端产生很多输出。

## 6.11 波特率与比特率

增加数据传输量：1 增加电平数 2 增加波特率

波特：每秒信号改变的次数 baud
比特率（bit/s） = 波特 * log2(电平数)

给定时间传送的数据量：

* 信号电平的数目
* 系统维持在某一个电平上的时间长短

给定时间内增加数据传输量：

* 减少系统在一个信号电平上持续的时间（增加波特率）
* 增加信号电平的数目：多电平可以表示多个数据位

波特（baud）：**每秒内信号能改变的次数**，例如信号在一个电平上维持0.001s，那就说这个系统工作于1000波特的速率

比特率（比特/秒）（bit/s）：波特率和信号的电平数决定了比特率

* 两个信号电平：每波特传输一比特
* 四个信号电平：每波特传输二比特

比特率=波特*log2（电平数）

## 第六章补充

#### 模拟信号 - 数字信号转换：

##### 脉码调制：

- 对模拟信号电平按固定时间间隔进行反复测量并转换为数字技术。
- 抽样 - 每个测量值称为抽样值（取均值）
- 量化 - 将每个抽样值记录为整数
- 编码 - 将抽样值编码成特定格式

##### delta调制，增量调制

- 抽样值是与前值的delta
- 传输差值需要的位数比传输全部样点值所需要的比特位数少
- 但是丢失任何一位会毁坏后续所有值

#### 奈奎斯特定理：

抽样率 = 2 * fmax
fmax -- 信号中最高频率

即信号进行采样至少应是信号中需保留的最高频率的两倍

#### 电话系统：

对人类语音进行测试表名，保留信号中0-4000Hz的频率成分，根据奈奎斯特定理，把语音信号从模拟转换为数字信号的采样率应该是每秒钟8000次。

电话系统中的PCM标准使用8位值对采样进行量化。输入信号的电平范围被划分为256个等级

单个电话呼叫所产生的数字数据的速率为8000次/秒 x 8比特/次 = 64000比特/秒

现在以64k作为标准

数字化话音速率 = 4000Hz * 2 * 8 bit/pt = 64000 bit/s
8 bit - 256 个电平级别 - 0~255

## 7.2 导向传播与非导向传播

两种对传输介质的分类方法：

路径：

* 沿着确切路传输信号（导线）
* 没有明确路径（无线电传输）

能量：

* 电气能量应用于有限传播
* 无线电波应用于无线传输
* 光应用于光纤

#### 导向和非导向

导向传播（物理介质传输）

* 物理介质提供明确的路径
* 铜导线或者光纤

非导向传播（无线电波传输）

* 无线电通过自有空间在所有方向传播

## 7.3 按能量形式分类

根据用于传输数据的能量形式，对物理介质进行分类

能量类型

电气的：双绞线、同轴电缆

光：光纤、红外线、激光

电磁波（无线电波）：地面无线电、卫星

## 7.6 同轴电缆盒屏蔽双绞线

双绞线可以抵御大多数背景辐射的影响，但是不能解决所有问题，在遇到特别强的电气噪声或者与噪声源之间的物理距离非常近或者使用高频率的时候还有问题。

同轴电缆

塑料外壳+编制金属屏蔽层+塑料绝缘层+内层信号导线

同轴电缆可以放置在电气声源和其他电缆邻近，而且可以应用于高频率通信

屏蔽双绞线STP比同轴电缆柔韧但是抗噪声干扰的能力不及同轴电缆

## 7.7 双绞线分类



## 8.4 处理信道差错的两种策略

信道编码：为了克服数据差错从而增加可靠性

* 向前纠错机制
* 自动重传请求机制

#### 向前纠错机制

在发送数据时增加冗余信息，接收方收到数据以后可以根据冗余信息校验所接收数据是否正确，甚至在有可能的时候进行纠错

#### ARQ

自动重传请求机制，需要发送方的合作——发送方和接收方之间交换信息，以确保所有数据都能够正确到达

## 8.7 分组码数学与（n，k）表示

消息插入附加位产生已编码消息

数据字集合：所有可能的消息集合

码字集合：所有可能的编码消息

码字中可能的组合称为码簿

## 8.9 码簿中的汉明距离

两个位串进行或运算，结果中1的个数就是两个码字的汉明距离

最小汉明距离，最少要多少位差错才会引起一个有效码字转换成为另一个有效码字

编码效率：R=k/n数据字长度与码字长度的比值

## 8.11 纵横奇偶校验的纠错

纵横就校验编码技术使接收方能纠正所有单个位元的差错，并能检测到奇数个比特位被改变的情况。

## 9.12 单工、半双工和全双工传输机制

#### 单工

单工只能在单一方向传输数据

例子：

* 单条光纤实现单工传输，因为光纤一端是发送设备（发光二极管或激光器），另一端是接受设备（光敏接受器）
* 单工传输类似于无线电广播或电视广播

#### 全双工

底层系统允许两个方向的传输同时进行

典型的全双工机制由两个单工机制组成，每个负责一个方向的信息再送。

例如：

将一对光纤并行排放并且安排他们分别朝相反方向发送数据，这对光纤就可以用于提供全双工机制

#### 半双工

半双工机制包括一个共享的传输介质。这个共享介质可以用于每个方向的通信，但是不同方向的通信不能同时进行。

例如:

对讲机的原理相似，同一时间只能有一个方向的传输。

在半双工通信中，介质的两端需要增加额外的机制来协调通信，以确保在给定时间上只有一端发送消息。



## 11.3 复用的基本类型

在物理层，有四种实现复用的基本方法

* 频分复用（FDM）
* 波分复用（WDM）
* 时分复用（TDM）
* 码分复用（CDM）

## 11.4 频分复用

无线电广播基础

在单根铜导线上同时发送多路载波，或者利用波分复用在一根光纤上同时发送多个频率的光信号，每个过滤器提取载波频率附近的一个小的频率范围

FDM只检查频率，不同频率的载波波形不会互相干扰

## 题11.2(对应章节11.3)



## 13.2 电路交换

电路交换指的是一种在发送方与接收方之间建立一条通路的通信机制，它能保证该通路与其他发送方和接收方之间使用的通路是分开的，早期电话系统在两部电话之间提供了专门的连接

现代电路交换网络使用电子设备来建立电路，并且它也不是让每条电路对应一条物理通路的，而是让多条电路复用在共享介质上，所形成的电路称为虚电路。

三个一般的特性定义了电路交换模式：

* **点对点通信**
  * 一条电路恰好在两个端点之间形成
* **电路建立、使用和终止由分开的步骤完成**
  * 用于将交换式电路（在需要的时候才建立）与永久电路（总是保持随时可用）区分开来
  * 类似于拨打电话的三阶段处理过程
    * 某应用程序视图通信时，建立电路
    * 通信双方使用电路进行通信
    * 双方终止电路的使用
  * 一旦通信结束电路被移除
* **性能上等价于一条独立的物理电路**
  * 与其他网络类型关键性的不同
  * 双方通信不会受到其他通信方之间的通信的任何影响，哪怕所有的通信都复用在一个公共的介质上

电路交换在一对通信实体之间提供一种独立物理通路的幻象。通路在需要时候建立，使用完成后就断开

## 13.3 分组交换

是电路交换之外一种交换方式，是形成物联网的基础

使用统计多路复用技术，来自多个信源的通信竞争使用共享介质

与==统计时分多路复用技术==的其他形式之间存在的主要差别：产生分组

要求发送方将保温分割成称之为分组的数据块。每个分组的长度是可变的，每种分组交换技术都会定义一个最大的分组长度

* 随意的、异步的通信
* 通信开始前无需建立连接
* 因分组间的统计多路复用致使性能可变

第一个特性：分组交换允许一个发送方与一个或者多个接收方通信，并且一个接收方可以接受多个发送方的保温

通信可以发生在任何时刻，并且相继通信事件之间发送方可以延迟任意长的时间

第二个特性：分组交换系统随时保持在准备状态。随时可以向任何目的地发送分组、因此通信前不需要执行初始化操作，也不需要在通信终止时通知任何底层系统

第三个特性：多路复用发生在分组之间，而不是发生在比特或者字节之间。一旦发送方得到了访问底层信道的机会，就可以发送一个完整的分组，然后允许其他发送方发送一个分组。

在其他发送方都不准备发送分组的时候，允许单个发送方不断连续发送分组。

如果多个发送方共享一个分组交换网络，网络的设计原则是让每个发送方平等共享网络。也就是说N个发送方每个都有大量的分组准备发送，那么一个指定的发送方很难过发送大约是总分组量的1/N

分组交换是形成因特网的基础，是统计时分多路复用的一种形式，允许多对多方式的通信。发送方必须将保温分割成一系列的分组。发送方发送一个分组后，网络的设计原则是该发送方发送后续分组之间允许其他发送方发送分组

#### 优点

成本低：共享的特性

电路交换必须为每台计算机提供一条连接，为了使得N太计算机之间通信，外加至少N/2条独立的通路。

分组交换的话，虽然网络必须与每台计算机有一个连接，但是只需要一条共享的通信

## 13.4 局域和广域分组

分组交换技术根据跨距进行分类

局域网（LAN）：费用偏移，跨距在单个房间或者单个建筑物范围内

城域网（MAN）：费用中等昂贵，跨距在一个大城市范围内

广域网（WAN）：费用最昂贵，跨域在多个城市的站点

MAN通常归结于WAN范畴内

## 13.6 IEEE 802模型标准

IEEE将协议栈的第二层分成两层，并用术语子层来表示这种划分。

子层定义了第二层协议的不同方面，比如寻址和介质共享问题

**LLC：逻辑链路控制（logical link control）：寻址和解复用**

**规定编制以及解复用技术中地址的使用**

**MAC：介质接入控制（Media Access Control）：接入共享介质**

**规定多台计算机如何共享底层的介质**

IEEE分配一种型如XXX.YYY.ZZZ的标识符。XXX表示标准的大类，YYY表示子类

## 13.7 点对点与多址接入网络

**点对点指恰好连接两个通信实体的通信机制**

多只接入技术：LAN上的任意太计算机可以与其余任意台计算机相互通信

LAN是一种多址接入式网络

LAN网络有四种拓扑：总线、环形、星型、网状

## 13.9 分组标识、解复用、MAC地址

### 分组标识、解复用

在分组交换系统中，解复用技术使用一个叫做地址的标识符，每台计算机分配一个唯一的地址，每个分组包含着期望接收方的地址

### MAC地址

IEEE编址方案中，每个地址由48比特的二进制组成，术语：介质访问控制地址MAC地址

由于48位的地址来源于以太网技术，因此网络专业人员使用术语以太网地址来称呼

IEEE为每块网络接口硬件分配一个地址

NIC网络接口卡在生产时，包含一个唯一的IEEE地址

IEEE给每个设备制造商分配一个地址块

* 三字节机构唯一标识符OUI
  * 最高有效字节的2个低阶位已经分配了特殊的含义
    * 最低位是一个多播位
      * 规定是一个单播地址还是多播地址
    * 次低位规定OUI是全局唯一的还是本地分配的
      * 全局唯一：IEEE分配
      * 本地分配：只对实验性工作或者想创建自己的地址空间的机构有效
* 三字节标识一个特定的网络接口控制器NIC

## 题13.1（对应章节13.2）

什么是电路交换，主要特征是什么

电路交换是一种在发送方和接收方建立一条通路的通信机制，它能保证该通路与其他发送方和接收方的通路是分开的。电路交换技术通常与模拟电话技术紧密相关，因为电话系统在两部电话之间提供了专门的连接。

现代电路交换网络使用电子设备来建立电路，而且不是每一条电路都建立一条物理通路，而是多条电路复用在共享介质上，所形成的电路叫做虚电路。

三个主要的特性：

* 点对点通信
  * 每一条通路连接两个端点
* 建立、使用和终止由分开的步骤完成
  * 需要使用的时候创建，使用完成后销毁
  * 与永久性电路区分开来
* 性能上等价于一条独立的物理网络
  * 与其他挖网络类型关键性的不同

## 题13.5（对应章节13.4）

LAN,MAN,WAN的特征是什么

LAN，局域网，费用比较便宜，跨距在单个房间或者单个建筑物范围内

MAN，城域网，费用中等昂贵，跨距在一个大城市范围内

WAN，广域网，费用最昂贵，跨距在多个城市站点

## 题13.6

说出IEEE定义的第2层协议的两个子层的名称，并指出它们的用途

==第二层协议是物理层还是数据链路层==

两个子层：

LLC，逻辑链路控制：寻址和解复用

MAC，介质接入控制：接入共享介质

## 题13.12

在分组交换网络中，每个帧都会对应数据链路层的一个分组

## 14.2共享访问机制的分类

#### 受控接入协议

预约

轮询

令牌传递

#### 随机接入协议

ALOHA

CSMA/CD带冲突检测的载波侦听多地址接入，二进制指数退避法

CSMA/CA带冲突避免的载波侦听多地址接入，随机退避算法

#### 信道分配协议

频分多址

码分多址

时分多址

## 14.6 随机接入协议

当一个站点有分组需要发送的时候出现，采用随机选择方式，以防局域网同时使用介质

ALOHA历史上著名的一种协议，在夏威夷的早期无线网络中使用过。在教科书中比较流行并且容易分析，但是美欧在时间网络中使用

CSMA/CD带冲突检测的载波侦听多址接入，以太网的基础，并且也是最为广泛使用的随即介入协议

CSMA/CA冲突避免的载波真挺多址接入，是WIFI无线网络的基础

### 14.6.1 ALOHA

网络由单台位于宗信地理位置的功能强大的发射机以及围绕在周围的一组站点（每个对应一台计算机）组成。每个站点有一个发射机，其辐射范围达到中心发射机，但是不足以达到所有其他站点。

上行频率：407.305MHz，由中心发射机发送给所有有站点的广播业务

下行频率：413.475MHz，由各站点向中心发射机发送的业务

过程：

站点在上行频率上发送这个分组

中心在下行频率上重发分组（让所有站点收到）

* 有副本到达，发送站点转移到下一个分组的发送阶段
* 没有副本到达，发送站点等待一段时间重新尝试

冲突：

如果两个站点试图同时在上行频率上发送分组，信号就会互相干扰而两个传输也会出现混乱

解决：

协议通过请求发送方重新发送每个损坏的分组来处理冲突

随机选择L每个站点选择一个随机延迟，使得重传正好等待相同时间的概率减低

### CSMA/CD

DIX标准：以太网（Ethernet）

使用随机接入协议

原始以太网由一根长同轴电缆以及连接在电缆上的计算机组成

电缆充当共享介质——以太网**不借助大气传输来广播无线频率，而是在电缆上传输信号**

以太网**不使用两种频率和中心发射机**，它允许所有通信都在共享电缆上进行

#### 冲突解决

* 载波侦听
* 冲突检测
* 二进制指数退避

##### 载波侦听

以太网要求每个站点检测电缆，检测是否有另一个传输正在处理之中

载波侦听组织了明显的冲突问题，充分提高网络的利用率

##### 冲突检测

如果两个站点正在等待某一传输的结束，电缆空闲后同时启动发送过程，还是会发生冲突

信号即使是光速传输，沿着整条电缆传递还是需要时间。电缆一段的站点无法立刻知道另一段的站点什么时候开始发送

解决：

每个站点发送过程中都监测电缆。如果发现电缆上信号与本站发送出去的信号不符合就意味着出现了重弄图，只要检测到冲突，发送站点就立刻中只发送

两种更复杂的扩展：

出现冲退后不会马上终止，知道已经发送了足够多的位，保证冲突信号到达所有站点

在一次传输之后，站点必须等待一个分组间隙，以确保所有站点都感觉网络已经空闲并且有心到可以用于传输

##### 二进制指数退避发

从冲突中恢复

以太网随机选择的办法来避免电缆一出现空闲就有多个站点同时发送

做法：

规定一个最大延迟值，要求每个站点在冲突发生之后选择一个小于d的随机延迟。选择较小延迟至的站点先开始发送帧

如果有量太多这多台计算机恰好选择了几乎相同的延迟，就会同时开始发送，导致第二次冲突。以太网妖气每台计算机在每次冲突后把选择延迟的范围加倍

* 第一次冲突后在0-d之间选择随机延迟
* 第二次0-2d之间选择
* 第三次在0-4d之间选择

在几次冲突后，选择随机值的范围变得很大，避免了再次发生冲突的可能

二进制退避算法：每次冲突后随机延迟的范围加倍

本质上意味着以太网可以在冲突后迅速恢复，当电缆繁忙时，每台计算机都同意在两次尝试之间等待更长的时间。

带冲突检测的载波侦听多地址接入

使用CSMA/CD发送一个分组

算法：

等待分组做好发送准备

等待介质出现空闲（载波侦听）

延迟一个分组间间隙

将变量x设置为标准退避范围d

尝试发送分组（冲突检测）

当（前一次传输中发生冲突）{

​	在0和x之间选择一个随机延迟q；

​	延迟qms；

​	将x加倍以防下一轮之需；

​	尝试重传分组（冲突检测）；

}

#### 14.6.3 CSMA/CA

CSMA/CD在电缆介质上工作得很好，但是在无线LAN中没有工作得那么好，因为无线LAN中所用的发射机有一个受限的发射范围。

离发射机的距离超过某一个值得接收方将无法收到信号，因而无法检测载波

三个排成一排的计算机，都装有无线网卡，相邻两台相距最大的发射范围

站点隐藏问题：相邻计算机能够通信，但是1和3无法接受对方的信号。如果两台计算机同时向2发送分组，会发生冲突

指有些站点对于其他站点来说不可见

无线LAN使用避免冲突的载波侦听多地址接入CSMA/CA（collision avoidance）

无线LAN中使用的CSMA/CA并不依赖于所有计算机都能接受全部传输与，而是在发送一个分组之前先从预期的接收方触发一个很短的传输过程

如果发送方和接收方都发送一个报文，那么两天计算机范围内的所有计算机都将知道一个分组即将开始

冲突解决：

如果左右两个计算机同时向中间计算机发送控制报文，中间计算机检测到冲突的发生，则不进行相应。最终两个控制报文总有一个能够正确到达，接着计算机发送一个响应报文

总结：由于无线LAN中计算机距离跨度大于信号的传播范围，无线LAN采用了CSMA/CA技术，发送计算机与接受计算机在分组传输开始前都会发送一个控制报文

## 题14.8（对应章节14.6）

carrier secse multi-Access with collision detection

带冲突检测的载波监听多地址接入

##### 载波侦听

以太网要求每个站点检测电缆，检测是否有另一个传输正在处理之中

载波侦听组织了明显的冲突问题，充分提高网络的利用率

##### 冲突检测

如果两个站点正在等待某一传输的结束，电缆空闲后同时启动发送过程，还是会发生冲突

信号即使是光速传输，沿着整条电缆传递还是需要时间。电缆一段的站点无法立刻知道另一段的站点什么时候开始发送

解决：

每个站点发送过程中都监测电缆。如果发现电缆上信号与本站发送出去的信号不符合就意味着出现了重弄图，只要检测到冲突，发送站点就立刻中只发送

两种更复杂的扩展：

出现冲退后不会马上终止，知道已经发送了足够多的位，保证冲突信号到达所有站点

在一次传输之后，站点必须等待一个分组间隙，以确保所有站点都感觉网络已经空闲并且有心到可以用于传输

##### 二进制指数退避发

从冲突中恢复

以太网随机选择的办法来避免电缆一出现空闲就有多个站点同时发送

做法：

规定一个最大延迟值，要求每个站点在冲突发生之后选择一个小于d的随机延迟。选择较小延迟至的站点先开始发送帧

##### 多址接入

允许多个用户或者主机共同使用共享介质，允许任一台计算机与其余台相通信

## 15.1 以太网

以太网是在所有网络中占支配地位的一种有线LAN技术

## 15.3 以太网帧格式

术语帧指的是二层分组，术语帧格式指的是对分组进行组装的方式，包括帧长度和每个域的含义等细节

帧格式保证了以太网旧版本和新版本保持兼容

帧格式：头部+46 ~1500字节的载荷+4字节CRC

头部细节：6字节目的地址+6字节源地址+2字节类型（1字节=8位）

固定长度头部+可变长度的载荷+固定长度的循环冗余校验码

## 15.9 双绞线以太网布线和集线器

第三代系统使用一个**中央电子设备（集线器）**来取代**同轴电缆**，它将连接到网络上的计算机分隔开来

第三代系统采用**双绞线**来取代笨重的**屏蔽电缆**

第三代技术成为双绞线以太网（因为不适用同轴电缆）并且取代了其他版本

以太网不再是电缆形式，而是一种能连接计算机的电子设备

对于双绞线以太网最初版本而言，那个作为中心互联设备使用的电子设备被称为**集线器**，集线器有多种型号，其费用也与其型号的规模大小成正比

小的集线器有4个或者8个端口，每个端口可连接一台计算机或者其他设备

大的集线器可以容纳几百个链接

集线器中的电子部件方针的物理电缆的特性，使整个系统能够像传统以太网那样运行

例如：

连接在集线器上的计算机采用CSMA/CD协议来接入网络，接受每个帧的副本，并利用帧中的地址来决定是否处理还是忽略手打的帧

计算机上的网络接口处理所有细节和隐蔽任何差异：不区分粗缆以太网，细揽以太网以及双绞线以太网

因此计算机发送和接受分组的格式保持不变

#### NIC：网络接口卡

在系统内部，连接到计算机的I/O总线上

主要处理地址识别、CRC计算和帧的识别

例如：NIC检查珍重的目的地址，忽略不是发送给本机的帧

将计算机连接到网络，处理数据通信的细节问题（发送和接受帧）

## 16.5 无线LAN技术和WIFI

IEEE标准：原始802.11\802.11b\802.11g\802.11n

## 17.2 距离界限与LAN设计

距离限制是局域网设计要考虑的一个基本因素。

距离限制的原因是由于设计的硬件只能发出一定的能量，如果布线超过了这个设计极限，站点将接收不到足够强的信号

## 17.4 中继器

中继器是用来扩展LAN的模拟硬件设备，中继器放大所有输入信号，然后再发送到另一端

中继器是用于远距离传播LAN信号的模拟设备

中继器不理解分组或者信号编码，只是放大接受的信号，并将放大的信号再输出继续传输

中继器引入了红外线远程控制系统，允许接收器放置在远离发射器的地方

例如：

有线电视控制器的红外接收器与控制器放置在不同的房间，中继器可以用于扩展这种连接，不需要理解指令，只需要转发到达远端传感器的信号的副本

## 17.5 网桥与桥接

网桥是一种连接两个LAN网段（如两个集线器）并在网段之间传输分组的机制。

网桥以混杂模式监听每个网段（接受所有被发送到网端上的分组）

当网桥从一网段接收到一个完整帧时候，会将此帧的一个副本转发到另一个网端上。因此连接到一个网段的两个LAN网段，行为表现与单一LAN相似，即连接于任一网段的计算机可以给两个网段的恶任一计算机发送帧

广播帧也会转发给两个网段内的所有计算机

计算机不知道连接在单一的LAN网段上海市在被桥接的网段上

卫星通信需要两个网桥

## *17.6 自学习网桥与帧过滤

网桥不将每个帧的副本盲目地从一个LAN转发到另一个LAN，而是要利用MAC地址来进行过滤（filtering）操作。

网桥检查帧中的目的的地址，并只在必要的时候才将帧转发到另一个LAN网段。如果LAN支持广播或者多播，网桥必须转发每个广播帧或者多播帧的副本，从而使得桥接LAN的操作像单一LAN那样

自适应或者自学习的网段：自动获悉计算机的位置

提取源地址：当一个帧从某各网段到达时，网桥从帧头部提取源地址，并将该地址加入到连接于此网段的计算机列表中

提取目的地址：网桥还提取目的MAC地址，并利用此地址来确定是否转发此帧。这样只要计算机发送一个帧，网桥即可获悉此计算机处于哪个网段中

刚启动的时候，网桥不知道任何电脑的位置，需要较长时间学习

启动时候的第一次事件发送给所有网段，并把原地址加入网段的位置信息，即把计算机处于哪个网段记录下来

## 十八章概念学习

#### 分组交换机

有特殊用途只能放在每个站点的硬件设备，既可以提供站点内计算机之间的连接，也可以提供通向另一个站点的数据线路的连接

由一个小型计算机系统组成，包括处理器，存储器和用于收发分组的I/O设备



## ***\*18.12 分布式路径计算

==两个问题：==

==第一次循环的时候是不是只有相邻的路径会被传播==

==每次增加一个长度距离，那么如果2向外延伸有五条边是不是要循环5次==

WAN需要完成分布式路径计算，不是通过一个集中的程序来计算所有的最短路径，而是通过每个分组交换机在本地计算自己的转发表

所有分组都必须参与分布式路径计算

* 链路状态路由（LSR）采用Dijkstra算法
* 距离向量路由（DVR）采用另一种算法

### 18.12.1 链路状态路由（LSR）

link-state routing

最短路径优先（SPF）

每个分组交换机周期性的向网络发送两分组交换机之间链路状态的报文。例如“交换机5和交换机9之间的链路畅通”。

每个状态报文广播给网络中所有的交换机。

每个交换机根据收到的报文构建一个网络图，使用Dijkstra算法生成转发表

算法Dijkstra：

```
给定：
每条边分配一个非负的权值和指定源节点的图
计算：
从源节点到每个其他节点的最短距离D和下一跳路由表R
方法：
初始化集合S，含有除了源节点以外的所有节点
初始化数组D，如果边存在，D[v]则是源到v的边权值，否则D[v]无限大
初始化表项R，如果从源到v边存在，R[v]赋值为v否则为0
当（集合S不为空）{
	从S中选择D[u]值最小的节点u
	如果最小的D[u]是无限值{错误：集合S中到该节点没有路径存在，退出}
	从集合中删除u；
	对于每一个与u有直接边的v{
		如果v仍然在S中{
			c=D[u]+weight(u,v);
			假如(c<D[u]){
              	R[v]=R[u];
              	D[v]=c;
			}
		}
	}
}
```



硬件故障适应：

如果链路终端，与链路相连的分组交换机检测到故障，广播一份表明该链路中断的状态报文。

所有交换机更新网络图的备份，重新计算最短路径

当一个链路恢复使用时，与该链路相连的分组交换机检测到正常的状态，开始发送链路可用的状态报文

### 18.12.2距离向量路由DVR

相同：

每条链路都被赋予权值

到达目的地的距离定义相同

安排分组交换机周期性的交换报文

不同：

发送的报文：包含所有目的地和到达每个目的地的当前代价的完整列表

发送一系列下述的语句：

“我能到达目的地X，目前我和它之间的距离是Y”

报文不是广播，而是发送给相邻的交换机

报文格式（目的地，距离）

每个分组交换机保存一份包含所有可能目的地的列表，表中包含距离和下一跳。

接收到报文时，检查交换机报文中的每一项，如果有比自己短的就更改

LSR中，网络所有节点会同时得知链路出现了故障，但是DVR算法中，每个分组交换机会在发送之前计算，因此通知到所有的分组交换机需要更多时间

```
给定：每个表项带有距离的本地转发表，都打每一个邻居的距离，从邻居传入DV的消息
计算：一个更新的转发表
方法：在每一个转发表项中维护距离域。
```



## 18.13

边权值的调整

* 交换机数目
* 基础连接的传输容量表示
* 管理员给主路线低的权值

## 题18.12（对应章节18.12）

分布式路由计算的两种基本方法是什么，它们各自是如何工作的

### 链路状态路由

给定一个带权值的图

初始化目的地集合，包括除了源节点的所有节点

初始化距离数组，除了直接到达的节点值为边的权值，其他的值为无穷大

初始化下一条数组，除了直接到达的节点值为节点序号，其他的值为0

在目的地集合不为空的情况下，取出距离最短的节点，从集合中删除

将与删除节点有边的节点在源节点的两个数组进行比较和更新

如果目的地集合为空，或者与集合中节点的最短距离为无穷大，则遍历结束

### 距离向量路由

给定一个带权值的图

初始化目的地的路由表数组，D[o,i]=(i,j,k)，i为目的地，j为下一跳，第一次遍历通常为i本身，k为距离

第一次循环：

接受每个相邻的节点的初始化报文，遍历报文，对报文中的每一个目的地的路径长度进行比较，如果源节点对于该目的地不存在，或者比接受报文的远（包括经过其他节点，和经过这个邻居节点，但是邻居节点更新了值得情况）则更新本地的路由距离。

第二次循环：

这次循环主要是更新过一次以后，对于被更新的邻居节点进行更新源节点的路由距离，同时邻居节点可能有更远的距离已经更新，应当添加到源节点的路由距离中。

## 20.3全局服务

每个组织有各种不同的网络类型，例如以太网和租用数据电路。

允许任意两台计算机之间能够相互通信，称为全局服务

## 20.5 网络互连

网络互连：尽管网络技术互不兼容，研究人员设计出了一种方案，能**在异构网络间提供全局服务**

既用硬件也用软件

附加的硬件系统用于将物理的网络互连，然后在所有相连的计算机中运行的附加软件，即可提供全局服务

互联网：连接物理网络所形成的网络系统被称为互联网络internetwork

互联网没有规模上的限制

* 几个网络的互联网
* 成千上万个网络的全球因特网

网络互连：异构网络中提供全局服务

互连网络：连接物理网络所形成的网络系统称为互联网络或者简称互联网

## 20.6 路由器

用于连接异构网络的基本硬件设备是路由器

路由器含有处理器和内存，以及用于连接每个网络的输入输出接口

路由器可以将多个使用任意的网络技术的网络互联起来

## 20.7 互联网体系结构

采用多个小路由器而不是一个昂贵的路由器

* 在业务量超过路由器容量的时候单独升级
* 如果存在多条通路，一条链路发生故障时，因特网技术沿着另一条通路传输。避免单点故障

## 20.10 虚拟网络

因特网软件提供了一个连接许多计算机的单一而无缝的通信系统。这种系统提供全局服务，每台计算机只分配一个地址，任何计算机都能发送分组到其他计算机。

因特网协议软件隐藏了物理网络连接、物理地址以及路由信息等方面的细节

互联网是一种虚拟网络系统，因为这个通信系统只是一种抽象而已，虽然硬件和软件联合提供了一个单一网络的错觉，但是这单一网络并不存在

## 20.12 TCP/IP分层结构综述

TCP/IP分层结构综述

第三层IP规定因特网中传输的**分组格式**以及从第一台计算机通过一个或多个路由器到达最终的目的地的**分组转发机制**

第四层（TCP）规定了用于**确保可靠性传输的报文与过程**

因特网协议被组织为5个概念层，其中IP在第3层，TCP在第4层

## 21.1 IP

网际协议（Internet Protocal，IP）

每种网络技术都定义了自己的MAC地址，IP地址实现了因特网中的统一编址。IP协议定义了一个抽象的编址方案，给每台主机分配一个唯一的地址，应用程序之间使用IP地址进行通信

IPv4：32位，4个字节

IPv6：128位，16个字节

## 21.6 IP地址的层次结构

IP地址划分为两部分：前缀部分和后缀部分

IP地址前缀部分标识计算机从属的物理网络

IP后缀部分标识该网络上的一台计算机

因特网每一物理网络都分配一个唯一的网络号（nework number）

而网络号在属于该网络的每台计算机的IP地址中作为前缀出现。同一物理网络上每台计算机分配一个唯一的地址后缀

保证两个网络不能分配同一个网络号

保证同一网络上两台计算机不被分配相同的后缀

IP地址编址方案保证了两个重要的性质：

* 每台计算机只分配给一个唯一的地址（即一个地址不能分配给多台计算机）
* 虽然网络号分配必须与全球一致，但是后缀可以由本地分配，不需要全球一致

## 21.10 IPv4子网与无类编址==PPT==

ICANN->注册商->ISP->用户

ISP提供网络连接的厂商

两种途径克服原有IPv4的限制

如题

不采用三个不同的地址类，而是直接利用前缀和后缀在地址的任意位置上进行分解

子网编址最住应用在连接到全球因特网的大机构中，无类编址把这种方法扩展到整个因特网中。这样的思想同样适用于IPv6

得到最少的主机后缀，使得分配更加合适的长度的前缀

## 21.11 地址掩码

无类和子网编址要求处理及其的主机和路由器存储一点附加的信息，以便**指定网络前缀与主机后缀之间的准确界限**

IPv4使用了地址掩码的32位长的值（IPv6使用128位长的值）。地址掩码最早叫做子网掩码（subnet mask）。地址掩码中值为**1的位标识网络前缀，值为0的位标识主机部分。**

保存为位掩码的原因：提高地址计算的效率

在主机和路由器处理一个IP分组的手，需要比较转发表中的地址的网络前缀部分的值

网络前缀N

目的地址D

32位地址掩码M

N==(D&M)

## 12.21 用于IPv4的CIDR表示法

无类编址方案叫做无类域间路由classless Inter-Domain Routing

地址和掩码通过在一个点分十进制地址的后面附加一个斜杠符和一个十进制来表示，十进制表明了掩码中从地址最左边开始的连续的1的位数 

## *21.14 CIDR主机地址

ddd.ddd.ddd.ddd/m

ddd是地址中8位组等价的十进制数值m是掩码中1的个数

网络前缀

地址掩码

最低主机地址：后缀为0001

最高主机地址：后缀为1110

## 21.15 特殊IPv4地址

保留地址：从不分配给主机使用

### IPv4网络地址

用一个地址表示分配给某个特定网络的前缀

IP保留主机地址为0的地址表示一个网络

### IPv4直接广播地址

用于讲一个分组副本发送给某个物理网络中所有的主机

当一个分组要发送到一个网络的直接广播地址时，只有一个分组副本会通过因特网到达该网络，然后被传送给每一台主机

在网络前缀后面增加一个全1后缀，便形成了网络的直接广播地址

* 如果支持硬件广播：直接广播利用硬件广播能力实现
* 不支持硬件广播：软件必须为网络上每台主机发送分组的副本

### IPv4有限广播地址

指在本地物理网内的广播

广播被限制在“单根导线”上。一台还不知道网络号的计算机在启动系统时，可以采用有限广播

IP对所有要发送给全1地址的分组将通过本地网络进行广播

### IPv4本机地址

计算机发送或者接受因特网分组前需要知道自己的IPv4地址

当计算机启动的时候借助TCP/IP中的一个协议自动糊的IP地址

启动协议也需要使用IP尽心光通信，但是在启动协议的时候，计算机还没有一个正确的Ip地址，为了处理这种情况IPv4保留了全0来表示本台计算机

### IPv4回送地址

IP定义一个会送地址用于测试网络应用程序（loopback address）

在编写完成一个网络应用程序后，程序员往往还用会送测试的方法对程序进行预调试。

在统一计算机上虞奴性两个程序的进程，并指令它们在通信的时候使用回送IP地址

当一个地址应用进程发送数据给另一个应用进程的时候，数据向下通过协议栈到达IP软件，IP软件再把数据向上通过协议栈返回给另一个应用进程

127/8供回送测试使用，程序员经常使用主机号1，形成最普遍使用的回送地址127.0.0.1

## 21.16 特殊IPv3总结

前缀 后缀 地址类型 用途

全0   全0  本计算机 子举期间使用

网络  全0  网络         标识网络

网络  全1  有限广播  在制定网络上广播

全1    全1  有限广播  在本地网络上广播

127/8 任意 回送        测试



* 每个特殊地质只用于一种用途
* 全0地址在主机完成了启动过程并且获得ip以后就不再使用了


## 21.18 路由器与IPv4寻址原理

除了给每个主机分配一个因特网地址外，IP规定路由器也要分配IP地址

一个IPv4地址并不标识一台特定的计算机，而是标识一台计算机与一个网络之间的连接。一台连接多个网络的计算机（例如路由器）必须为每个网络分配一个IPv4地址

## 21.21 IPv6编址

与IPv4的不同

所有地址的细节都不同：IPv6地址具有三层结构

* 第一部分：全球唯一的值，用于因特网的路由
* 第二部分标识一个子网
* 第三部分对应网络上特定的计算机

IPv6地址的前缀可变，并且由ISP根据用户规模来选择

Ipv6的第三部分通常是固定的64位

如果ISP给某个单位分配了K位长度的全球前缀，该单位IPv6地址中的子网地址长度就是64-K



IPv6提供了受限范围的地址（比如，只能用于单个网络的地址和仅限于一个单位范围的地址）

一个IPv6地址只归属于下面三种类型之一

* 单播：该地址对应于单台计算机，送往这种地址的数据报将沿着一条最短路径被路由到该计算机
* 多播：该地址对应一组计算机，这些计算机可能在不同的地点，组内的成员关系在任何时刻都能改变。IPv6向组内的每个成员传递该数据报的一个副本，特殊多播：有限广播
* 任播：该地址对应于共享地址前缀的一组计算机，送往这种地址的数据报只会传递给他们中的一台计算机（例如最靠近发送方的那台）
  * 原先称为簇编制，源自于一种对重复性服务的需求，在网络上提供某种服务的公司可以为几台提供这种服务的计算机分配一个任播地址。当用户给任播地址发送一个数据报时，IPv6将该数据报路由到组中的某一台计算机，以允许簇中的两台计算机同时来处理这些请求

## 21.22 IPv6冒分十六进制数表示法

每16位为一组写成十六进制数，用冒号分割每个组。

用十进制表示分割成16个部分，用冒分十六进制表示分割成八位

优化：零压缩：用两个冒号代替连续的0

任何以80个0开头后面跟16个1的IPv6地址，低32位就含有一个IPv4地址

IPv6中设定得多播地址

* 对应于本地网络上的所有节点的所有地址，替代IPv4中全1的受限地址
* IPv6为本地网络上的所有路由器定义了一个多播地址

## 题21.8（助教写的）

## ==题21.14==

## 题21.9

如果ISP给你分配一个/28的IPv4或者IPv6地址块，这个地址快能给多少台计算机分配地址

IPv4：14台计算机

## 22.1 无连接服务

因特网传输基本单元IP数据报

设计互联网时需要考虑的基本问题之一就是网络需要提供什么样的服务

设计者必须决定是为程序提供面向连接的服务还是无连接的服务还是两者都提供

因特网设计者选择的协议不仅包括无连接服务还有面向连接的服务，他们选择了无连接的基本传送服务，并在这种无连接的下层服务之上增加了可靠的面向连接的服务

## 22.4 IP数据报

网际协议定义了一种独立于底层硬件的分组格式，能够完整无损的通过底层硬件传输的通用的、虚拟的分组

TCP/IP协议使用IP数据报这个名字来指特定的因特网分组

数据报的大小由发送方根据特定的用途选择合适的数据量

为了最大化一次传输的吞吐量，应用程序应该发送较大的数据报，但是数据报太大也会造成一些问题

转发表中的一项对应一个网络而不是一个主机

转发表：目的地、掩码、下一站

利用转发表为数据报选择下一站的过程叫做转发

当路由器遇到一个包含目的地地址D的数据报，软件检测转发表中的每一项，利用掩码提取地址D的前缀，并把结果与目的地址进行比较，如果相同就转发到该表项中指明的下一站去

如果遇到匹配时候的重叠地址掩码产生的歧义，因特网转发过程使用最长前缀匹配规则

## 22.5 IPv4数据报头部格式

IPv4数据报头部的每个域都有固定的长度

头部长度：4位长，指定以32位为度量单位的头部长度，值为5

总长度：16位长，指定以字节数计量的数据报总长度，包括头部长度和载荷长度

## 22.11目的地与下一站地址

数据报头部中的目的地址总是最终的目的地址，在每一个中间节点上，路由器都要计算下一站的地址，但是下一站的地址并不出现在数据报的头部中

## 22.13 IP封装

物理网络不了解数据报格式，采用封装的技术来使得数据报在网络中传输

当把一个IP数据报封装进一个帧时，将整个数据报放进帧的数据区（载荷），硬件不回去检查或者改变帧的数据区内容

当发送方讲一个数据报放入帧时，发送方计算机在帧类型域中内置一个值。

发送方计算机IP必须为下一站的IP地址找到它下一站的等效MAC地址，然后这个MAC地址作为帧头部中的目的地址

接收方收到带有数据报的帧吼，从帧中取出数据报，然后丢弃这一帧。如果数据报必须通过另一个网络转发时，就要生成一个新的帧

每个网络都可能使用不同的网络硬件技术，意味着他们的帧格式和帧头部长度可能各不相同

## 题22.10

不会，因为数据报的头部中只包含目的地址，路由器会根据目的地址计算下一个中间路由器的地址

**数据报头部中的目的地址总是最终目的地址。在每一个中间节点上，路由器都要计算下一站地址，但下一站的地址并不出现在数据报的投不中**

## 题22.13

把IP数据报封装进一个帧的时候，就是将整个数据报放进帧的数据区（载荷）

## 题22.14

一个头部，每个节点收到包含数据报的帧的时候，接受软件从帧中取出数据报，然后丢弃这一帧。如果数据报必须通过另一个网络转发，就生成一个新的帧。因此每次在网络中捕获到一个包含数据报的帧，都只有一个帧头部。帧头部会因为所在传输的网络技术不同而不同

## 23.2 地址解析

路由器会利用IP地址来选择下一站的地址，将数据报封装在硬件镇中，然后在网络上传输这种帧

地址翻译：在网络传输时必须包含下一站的MAC地址，IP地址是由协议软件提供的一种抽象地址，因为物理网络的应建设诶并不理解IP地址，所以一个帧在发送之前必须将下一站的IP地址翻译成等效的MAC地址

地址解析：address resolution，将计算机的IP地址翻译成等效的硬件地址的过程

当主机或者路由器需要向统一物理网络内的另一台计算机发送分组时，它必须进行地址解析，一台计算机永远不会去解析连接在原地网络上的计算机的地址

P253，如果A主机应用进程要向连接在远地网络主机F上的应用程序发送报文，主机A上的协议软件不会去解析F的地址。主机A上的IP软件首先确定分组必须经过的路由器R1，然后解析R1的地址。R1上的IP软件经计算得知R2是下一站路由器，因而解析R2的地址。最后由R2解析F的地址

## 23.3 IPv4地址的例子

主机X到Y传输的数据报的帧地址

发送方，下一站，源MAC，目的MAC，源IP，目的IP

## 23.4 IPv4地址解析协议（ARP）

X和Y连接在同一个以太网上，X发送一个广播：请求拥有某IPv4地址的计算机所拥有的MAC地址，广播报文只在本网络上传输

当计算机Y收到请求报文的一个副本时，回复一个报文说自己的MAC地址

## 23.5 ARP报文格式

ARP报文开始处有一个固定长度的域，用于指定所使用的硬件和协议地址的长度

## 23.6 ARP封装

ARP报文在物理网络上传输时，被封装在一个硬件帧内。ARP报文数据放在帧的载荷数据中

帧头中的类型域指明帧中含有一个ARP报文。

ARP请求和相应使用相同的类型值，因此帧类型不能区分ARP报文本身的各种类型，接收方必须检查ARP报文中的操作域，来确定它是一个请求还是相应

## 23.7 缓存

ARP从响应报文中提取并保存有关信息，以便能够应用于后续的分组交换

ARP不会永久的保存，而是在内存中维护一个绑定表，满或者长期未被更新时，就删除表中最老的项。

==ARP在进行查找的时候不进行更新，只有在请求或者响应报文经由网络到达的时候才会更新==

只有两种情况会更新表项：

不存在的时候，把请求中的IP写入，等待响应报文写入MAC地址

==发生变化的时候==：在缓存中直接拿了，怎么知道更新了

自己的目标计算机时候，把发送方添加进缓存

## *23.9 因特网控制报文协议（ICMP）

IP使用一个辅助协议来向源发送端（发送数据报的计算机）报告错误

IPv4：ICMP

IPv6：ICMPv6

IP与ICMP相互依赖：IP要依赖ICMP报告错误，ICMP利用IP来承载差错报文

ICMP报文类型：

* 差错报告的报文
* 获取信息的报文

数据报不能成功传递时利用“超时”或“目的地不可达”报文发送差错报告

测试网络连通性和映射：主机或者路由器收到一个“回应请求”报文时，ICMP软件携带与请求报文相同的数据发回“回应应答”

Ping：

Ping程序向远程主机发送一个请求后，要么宣布主机可达，要么宣布主机不可达

traceroute：

应用程序发送一系列的回应请求，TTL分别设为1、2、3……，第一个报文中TTL在经历一跳后会到期，第二个报文经历两跳后会到期，因此traceroute应用程序会从某路径中的每一个中间路由器收到一个ICMP超时的差错报文，并从最终目的地收到一个“回应应答”

ICMP报文传输时，产生一个IP数据报并且将ICMP报文封装在其中，ICMP是放置在IP数据报的数据区里面被传输的

如果携带ICMP差错报文的数据报出了错，就不再发送差错报文了

## 23.13 动态主机配置协议（DHCP）

ICMP最初的版本包含地址掩码请求（Address Mask Request）和路由器发现（Router Discovery）报文

Bootstrap协议（BOOTP）允许一台计算机获得IPv4地址、地址掩码和默认的路由器地址。

BOOTP采用广播方式发送请求报文，使用IPv4协议跟服务器通信，全1广播地址用做目的地址，全0用做源地址

BOOTP最初采用固定地址分配方案，服务器包含一个数据库，数据库保存着分配给网络的每台主机的IPv4地址

IETF扩展了BOOTP的功能，改名为动态主机配置协议（Dynamic Host Configuration Protocal），DHCP允许任意太计算机加入新的网络中并且自动获得IP地址。即插即用网络

DHCP与BOOTP协议的差别

某台计算机在使用BOOTP获得地址之前，网络管理员必须在BOOTP服务器上配置该计算机对应的IP地址

DHCP允许计算机移动到新的网络并获得配置信息，不需要管理员去人工修改服务器数据库

## 23.18 网络地址转换（NAT）

使同一站点的多台计算机能共享一个全球有效的IP地址

NAT的设备放置在因特网与站点之间的连接上，大多数实现将NAT内嵌在一种设备中

## 23.19 NAT操作与IPv4私有地址

NAT的目的是要提供一种虚拟的寻址机制

NAT使用两种类型的地址解决地址冲突问题

* NAT自身利用DHCP从用户的ISP那里获得一个全球有效的IPv4地址。
* 当站点内的一个主机连接网络运行DHCP时，NAT设备回应这个DHCP请求，分配一个唯一的私有地址，也称为不可路由地址

NAT使用的私有IPv4地址块

10.0.0.0/8 A类私有地址块

172.16.0.0/12 16个连续的B类地址块

192.168.0.0/16 259个连续的C类地址块

NAT最基本的操作就是：当数据报从站点进入因特网时替换其中的源地址，当数据报从因特网进入站点时，替换其中的目的IP地址

NAT利用地址转换表实现：将目的地址和发送方的私有地址记录在一起，收到数据报时，根据源地址（之前的目标地址）找到应该接受这个数据报的计算机的私有地址

## 23.20 传输层NAT（NAPT）

基本的NAT只能处理站点内的每台主机与因特网上唯一的目的地进行通信的情况

NAPT解决了任一台主机上运行任意多的应用进程，所有进程都可以跟因特网上任一个目的地进行通信。同一站点上的多台计算机可以与同一个目的地进行同时通信

网络地址与端口转换NAPT：进程利用协议端口号（protocal port number）来区分同一主机上的不同服务

NAPT利用端口号将每个数据报与TCP或者UDP会话进行关联

NAT仅仅涉及IP层，但是NAPT却是在传输层头部的基础上进行操作

NAPT包括四个部分

* 源协议端口号
* 目的协议端口号
* 源地址
* 目的地址

当同一站点的两个计算机访问同一个目的地的同一个端口，NAPT为两个连接选择新的源端口来发送和接受数据报

## 23.17 IPv6

(IPv6数据包格式，IPv6冒分十六进制数表示法)

## 题23.12

如果出现路径环路，路由器将会发送哪种ICMP差错报文，解释这个过程

超时或者目的地不可达将会被发送。

* 如果没有到目的地址的路由存在，则目的地不可达。
* 如果TTL数值超时了或者数据报的某些帧没有在规定的时间到达，则报告超时。

## 24.3 用户数据报协议UDP

TCP/IP协议组包含两个主要传输协议

* 用户数据报协议（UDP）
* 传输控制协议（TCP）

最大的区别：提供的服务

UDP

* 端到端：区分计算机上的多个应用程序
* 无连接：提供给应用的接口遵从无连接模式
  * 使用UDP的应用进程在发送数据之前不需要预先建立通信，在通信结束后也无需通知网络
  * 任何时候生成和发送数据，UDP允许在两个报文传输之间延迟任意长时间
  * 除了传输携带用户数据的分组外，不再传输任何其他分组
* 面向报文：使用UDP的应用进程所发送和接受的数据是单个报文
  * UDP不会讲报文分割成多个分组传递也不会组合起来传递
  * 如果进程发送太小的报文，造成数据报头部和数据部分的比率变大
  * 如果进程发送太大的报文，造成数据报长度大于网络MTU而要求分片处理。IP会对数据进行分片，导致效率的见地
* 尽力而为：最重要的特征
* 任意交互
* 操作系统无关

## 23.6 UDP应用

音频传输可以使用UDP，在丢失一个分组时，会在播放的时候产生声音的小间隙

但是在线购物应用系统，如果使用UDP会导致灾难性的后果，产生两份订单

## ==*24.7（与TCP进行对比）==



## 24.8 协议端口号

独立于底层的操作系统

每一台实现了UDP的计算机都必须提供协议端口号与操作系统所用的程序标识符之间的映射关系

7回应

37时间服务器

UDP两级封装，每个UDP报文封装在IP数据报中以便在因特网上进行传输，而数据报又被封装在帧中以便在某个物理网络上传输

## 题24.2

列出UDP的特点

- **端到端**：区分计算机上的多个应用程序
- **无连接**：提供给应用的接口遵从无连接模式
  - 使用UDP的应用进程在发送数据之前不需要预先建立通信，在通信结束后也无需通知网络
  - 任何时候生成和发送数据，UDP允许在两个报文传输之间延迟任意长时间
  - 除了传输携带用户数据的分组外，不再传输任何其他分组
- **面向报文**：使用UDP的应用进程所发送和接受的数据是单个报文
  - UDP不会讲报文分割成多个分组传递也不会组合起来传递
  - 如果进程发送太小的报文，造成数据报头部和数据部分的比率变大
  - 如果进程发送太大的报文，造成数据报长度大于网络MTU而要求分片处理。IP会对数据进行分片，导致效率的见地
- **尽力而为**：最重要的特征
- **任意交互**
- **操作系统无关**

## 题24.9

在一对一通信方式中，应用程序必须制定什么端点值？一对多呢，多对一呢？

* 为了实现一对一通信，应用程序要制定本地端口号，远地IP地址和远地端口号，UDP只是传递来自特定发送者的应用进程报文
* 如果要实现多对一通信，应用进程要制定本地端口号，但是通知UDP端点可以是任何系统，UDP就会把所有保温传递给本地应用进程
* 为了实现一对多通信，应用进程要制定本地端口号、远程协议端口号，UDP允许制定的所有应用进程的消息通过

## 25.2传输控制协议

协议软件提供常规计算机系统一样的语义：

保证迅速而又可靠的通信

数据必须按照发送的顺序传递

不能出现丢失或者重复现象

传输控制协议TCP是一个提供可靠性的传输层协议

## 25.3 TCP为应用提供的服务

TCP提供的服务主要有7个特点

* 面向连接
* 点对点通信
* 完全的可靠性
* 全双工通信
* 流接口
* 可靠的连接建立
  * 虚拟连接：由软件实现，底层的因特网系统并不对此连接提供硬件或者软件支持，只是由两台计算机上的TCp软件模块通过报文交换来实现一个连接的幻想
* 友好的连接关闭



TCP角度上整个因特网是一个通信系统，能够接受和传递报文，但是对报文的内容不做任何改变或者解释

## 25.5传输协议采用的技术

* 不可靠的通信
  * 丢失
    * 传输协议使用带重传的正向确认机制，只要一个帧完好无损的到达了接收方，接收方协议软件就要发送一个短的确认（ACK）报文来报告它成功接收
    * 发送端发送一个分组的时候启动一个计时器。如果一个确认在计时器超时之前到达，取消；如果超时，重新发送副本再次启动计时器。
    * 发送第二个副本的行为叫做重传，副本叫做重传数据
    * 协议通常限定一个最大重传次数
  * 重复、乱序
    * 传输协议采用了**排序技术**，发送端为分组附加一个序号
      * 如果是期待的下一个分组，递交给上一层
      * 如果是乱序到达，协议将它添加到列表中
      * 如果是重复的就丢弃
  * 损坏
  * 延迟
  * 重复
    * 协议软件用一个唯一的ID标记每一次**会话**，并且要求这个ID出现在**每一个分组**中。协议软件会丢弃任何到达但是含有不正确ID的分组
* 端系统重启
* 异构的端系统
  * 运行在强大处理器上的应用程序产生数据的速度过快，运行在弱小处理器上的应用程序过载
  * 解决：
    * 使用术语**流量控制**来指向处理这类问题的技术。
      * 最简单的形式：停走系统，发送方在发送完一个分组后就要等待接收方的回答。接收方准备好接受另一个分组时，发送一个控制报文，通常就是某种形式的确认。会导致极低的吞吐率
      * 滑动窗口：发送方和接收方都被变成使用固定的窗口大小，指发送方收到确认前可以发送的最大数据量。
        * 发送方和接收方确定窗口大小为4个分组，发送方开始发送数据时，提取数据填充4个分组，并发送每一个分组的副本，保留副本。接收方接收方分组时，返回一个确认给发送方，发送方丢弃副本发送下一个分组
        * Tw=min（C，Tg x W）
          * Tw滑动窗口吞吐率
          * Tg走停协议吞吐率
          * C底层硬件的容量
* 因特网拥塞
  * 所有发送者都激进的发送数据，中建交换机和路由器会因为太多的分组到达而发生过载
  * 接受多发出少，交换机数据暂时保存在内存中，拥塞会导致增加延迟。拥塞持续导致内存溢出，重传导致更更多分组，最终导致拥塞崩溃
    * 拥塞出现时，安排中间系统（路由器）通知发送方
    * 利用延迟增加量或者分组丢失率作为对拥塞程度的评估
  * 做出反应：降低发送分组的速率，滑动窗口协议通过临时减小窗口大小

## 25.11 缓冲、流控与窗口

TCP使用一种窗口机制来控制数据流

TCP的窗口是以字节计量的。

1. 当一个窗口建立时，连接的每一段都分配一个缓冲区来保存数据，并将缓冲区大小发送给另一端
2. 接收到数据时，TCP发送确认报文指明剩余缓冲区大小：窗口通告
   1. 进程读取数据速度和数据到达一样快：正窗口通告
   2. 发送方操作的速度快于接收方：零窗口。发送方收到一个零窗口通告停止发送，直到接收方重新通告一个正的窗口

## 25.12 三次握手

在采用三次握手建立一个连接的过程中，连接的每一方都要发送一个控制报文，为流量控制指明初始缓冲区大小以及初始序号

## 25.16 TCP段格式

TCP对所有报文都采用了单一的格式，用术语段指一个报文

一个TCP连接上包含两个数据流，每个方向上各有一个。如果每一端的应用进程同时发送数据，TCP就可在它所发送的单个段中携带输出数据和对输入数据的确认以及窗口通告，该窗口通告指出仍可用于接收数据的缓冲区的而数量

* 针对接收数据：
  * 确认号：指出下一次期待接受的数据的序号，相反方向和是哪个缺失数据开始的位置
  * 窗口：除去已经确认的数据外还剩多少可用的缓冲区空间
* 针对发送数据：
  * 序号：该出段中所携带的数据的第一字节的序号

## 题25.4 传输协议为实现可靠传输必须解决的主要问题是什么？

* **不可靠的通信**。因特网上发送的报文可能会出现丢失、重复、损坏、延迟或者乱序传递等
* **端系统重启**。在通信的任何时刻，通信两端的系统都有可能崩溃和重启。不同的会话之间不能出现混淆，即使有些嵌入系统完成冲洗所需要的时间可能会小于一个分组在因特网上传输所花的时间
* **异构的端系统**。运行在强大处理器上的而应用程序产生数据的速度过快，以至于使运行在弱小处理器上的应用程序过载
* **因特网拥塞**。如果所有发送者都激进的发送数据，那么中建交换机和路由器就会因为太多的分组到达而发生过载，类似于拥堵的高速公路

## 题25.6 当使用窗口大小为N的滑动窗口技术时，在不要求收到一个ACK确认的前提下，可以发送多少个分组？

可以发送最多N个分组。滑动窗口的大小指发送方收到确认前可以发送的最大数据量

## 题25.8 扩充图25.3中的图示，表示出16个连续分组的传输过程



## 题25.13 TCP窗口大小控制的是什么？

控制的是发送方发送分组的速率

## 题25.16 网络上出现什么问题时，会促使TCP暂时减小它的窗口大小

如果网络发生拥塞，则需要做出恰当的反应，即降低正在发送分组的速率。滑动窗口协议通过暂时减小窗口的大小达到降低速率的效果



## 传输协议用到哪些技术

* 使用==优先位==，校验和和循环校验码来追踪传输错误
* 使用排序来处理重复和乱序发送
* 使用带重传的正向确认机来处理包丢失
* 一些技术来处理重复
* 使用流控制来放置过载
* 使用技术来避免拥塞



包丢失和延迟的主要原因是堵塞